#!/usr/bin/env bash

# SPDX-License-Identifier: BSD-3-Clause
# Copyright 2024-2025 <Nitrux Latinoamericana S.C. <hello@nxos.org>>

bat=""
for d in /sys/class/power_supply/*; do
    [ -d "$d" ] || continue
    t=$(cat "$d/type" 2>/dev/null || echo "")
    if [ "$t" = "Battery" ]; then
        bat="$d"
        break
    fi
done

if [ -n "$bat" ]; then
    capacity=$(cat "$bat/capacity" 2>/dev/null)
    status=$(cat "$bat/status" 2>/dev/null)
    if [ -n "$capacity" ]; then
        printf "ðŸ”‹ %s%% (%s)\n" "$capacity" "$status"
        exit 0
    fi
fi

if command -v acpi >/dev/null 2>&1; then
    info=$(acpi -b 2>/dev/null | head -n1)
    if [ -n "$info" ]; then
        percent=$(printf '%s\n' "$info" | awk -F', ' '{print $2}')
        status=$(printf '%s\n' "$info" | awk -F': ' '{print $2}' | awk -F', ' '{print $1}')
        printf "ðŸ”‹ %s (%s)\n" "$percent" "$status"
        exit 0
    fi
fi

exit 0
